@inherits TestContext
@namespace RizzyUI.TailwindVariants.Tests.Components.Button

@code
{
    public ButtonTests()
    {
        Services.AddTailwindVariants();
    }

    [Fact]
    public void Renders_BaseClass_ByDefault()
    {
        // Arrange
        var cut = RenderComponent<Button>();

        // Act
        var button = cut.Find("button");

        // Assert
        button.ClassList.ShouldContain("px-3");
    }

    [Fact]
    public void Applies_Variant_Primary()
    {
        // Arrange
        var cut = Render(
            @<Button Variant="@Button.Variants.Solid" />
        );

        // Act
        var button = cut.Find("button");

        // Assert
        button.ClassList.ShouldContain("bg-slate-900");
        button.ClassList.ShouldContain("text-white");
    }

    [Fact]
    public void Applies_Variant_Secondary()
    {
        var cut = Render(
            @<Button Variant="@Button.Variants.Outline" />
        );

        var button = cut.Find("button");

        button.ClassList.ShouldContain("border");
        button.ClassList.ShouldContain("border-slate-200");
    }

    [Fact]
    public void Applies_Size_Small()
    {
        var cut = Render(
            @<Button Size="@Button.Sizes.Small" />
        );

        var button = cut.Find("button");

        button.ClassList.ShouldContain("h-9");
        button.ClassList.ShouldContain("px-3");
    }

    [Fact]
    public void Applies_Size_Large()
    {
        var cut = Render(
            @<Button Size="@Button.Sizes.Large" />
        );

        var button = cut.Find("button");

        button.ClassList.ShouldContain("h-11");
        button.ClassList.ShouldContain("px-6");
    }

    [Fact]
    public void CompoundVariant_PrimaryLarge_Adds_ExtraClasses()
    {
        // Arrange
        var cut = Render(
            @<Button Variant="@Button.Variants.Ghost" Size="@Button.Sizes.Small" />
        );

        // Act
        var button = cut.Find("button");

        // Assert
        button.ClassList.ShouldContain("px-2"); // Example compound
    }

    [Fact]
    public void PerInstance_Classes_AreApplied()
    {
        var cut = Render(
            @<Button Classes="@(new() { Base = "rounded-full" })" />
        );

        var button = cut.Find("button");
        button.ClassList.ShouldContain("rounded-full");
    }

    [Fact]
    public void PerInstance_ClassProperty_IsApplied()
    {
        var cut =  Render(
            @<Button Class="m-2" />
        );

        var button = cut.Find("button");

        button.ClassList.ShouldContain("m-2");
    }

    [Fact]
    public void EnumerateOverrides_Yields_PerInstanceClasses()
    {
        // ARRANGE: Instantiate the Slots class directly, not the component.
        // This avoids the BL0005 warning and makes the test more focused.
        var slots = new Button.Slots { Base = "rounded-xl", Icon = "size-5" };

        // ACT
        var overrides = slots.EnumerateOverrides().ToList();

        // ASSERT
        // The GetName method is static on the Slots class, so we can call it directly.
        overrides.ShouldContain(t => t.Slot == Button.Slots.GetName(nameof(Button.Slots.Base)) && t.Value == "rounded-xl");
        overrides.ShouldContain(t => t.Slot == Button.Slots.GetName(nameof(Button.Slots.Icon)) && t.Value == "size-5");
    }
}