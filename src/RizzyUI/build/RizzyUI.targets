
<Project>
    <PropertyGroup>
        <_RizzyUITasksAssemblyPath Condition="'$(_RizzyUITasksAssemblyPath)' == ''">$(MSBuildThisFileDirectory)..\tasks\netstandard2.0\RizzyUI.Tasks.dll</_RizzyUITasksAssemblyPath>
    </PropertyGroup>

    <UsingTask
            TaskName="RizzyUI.Tasks.ComputeCallerFileNamePrefix"
            AssemblyFile="$(_RizzyUITasksAssemblyPath)" />

    <Target
            Name="_RizzyUI_ComputeCallerFileNamePrefix"
            DependsOnTargets="InitializeSourceRootMappedPaths"
            Condition="'$(SourceControlInformationFeatureSupported)' == 'true'">
        <ComputeCallerFileNamePrefix SourceRoot="@(SourceRoot)" ProjectDir="$(ProjectDir)">
            <Output TaskParameter="CallerFileNamePrefix" PropertyName="_RizzyUI_CallerFileNamePrefix" />
        </ComputeCallerFileNamePrefix>
    </Target>

    <Target
            Name="_RizzyUI_EmbedAssemblyStaticAssetInfo"
            BeforeTargets="CoreGenerateAssemblyInfo"
            DependsOnTargets="_RizzyUI_ComputeCallerFileNamePrefix;ResolveStaticWebAssetsConfiguration">

        <PropertyGroup>
            <!-- This is the key logic: Only set the base path for non-executable projects (i.e., libraries) -->
            <_RizzyUI_StaticWebAssetBasePath Condition="'$(OutputType)' != 'Exe'">$(StaticWebAssetBasePath)/</_RizzyUI_StaticWebAssetBasePath>

            <!-- Fallback if the prefix computation fails or is not supported -->
            <_RizzyUI_CallerFileNamePrefix Condition="'$(_RizzyUI_CallerFileNamePrefix)' == ''">$(ProjectDir)</_RizzyUI_CallerFileNamePrefix>
        </PropertyGroup>

        <!-- ALWAYS emit the two-parameter attribute. _RizzyUI_StaticWebAssetBasePath will be empty for the app project, which is correct. -->
        <ItemGroup>
            <AssemblyAttribute Include="RizzyUI.AssemblyRzAlpineCodeBehindAttribute">
                <_Parameter1>$(_RizzyUI_CallerFileNamePrefix)</_Parameter1>
                <_Parameter2>$(_RizzyUI_StaticWebAssetBasePath)</_Parameter2>
            </AssemblyAttribute>
        </ItemGroup>
    </Target>
</Project>